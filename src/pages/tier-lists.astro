---
import BaseLayout from "../layouts/BaseLayout.astro";

/**
 * We "probe" whether an image exists by just referencing it.
 * If it's missing, the browser shows a broken image icon, which is ugly.
 * So we render a "?" slot unless you confirm it's present.
 *
 * Since this is a static site and you don’t want to edit code every time,
 * we’ll do it the simple way: always render <img>, but hide it if it fails.
 *
 * This lets you upload files later without touching code.
 */
const tiers = [
  { key: "starters", label: "STARTERS" },
  { key: "midgames", label: "MIDGAMES" },
  { key: "endgames", label: "ENDGAMES" },
  { key: "slowers", label: "SLOWERS" },
  { key: "stunners", label: "STUNNERS" },
  { key: "bleed", label: "BLEED" },
  { key: "burn", label: "BURN" },
  { key: "boosters", label: "BOOSTERS" },
];

function imgPath(key, slot) {
  return `/images/tierlists/${key}/slot-${slot}.png`;
}
---
<BaseLayout title="Tier Lists | Nightshift Tower Defense User Guide">
  <!-- FULL PAGE BACKGROUND -->
  <div class="tierpage-bg" aria-hidden="true"></div>
  <div class="tierpage-bg-overlay" aria-hidden="true"></div>

  <div class="tiers-page">
    <header class="tiers-hero">
      <h1 class="tiers-title">Tier Lists</h1>
      <p class="tiers-sub">
        These are the best units in each category. Keep in mind that they’re all just my opinion, you should not take it as fact.
      </p>
    </header>

    <section class="tiers-grid" aria-label="Tier list categories">
      {tiers.map((t) => (
        <div class="tier-card" aria-label={`${t.label} tier list`}>
          <div class="tier-name">{t.label}</div>

          <div class="tier-slots">
            {[1, 2].map((slot) => (
              <div class="tier-slot">
                <img
                  src={imgPath(t.key, slot)}
                  alt={`${t.label} unit ${slot}`}
                  loading="lazy"
                  onerror="this.style.display='none'; this.parentElement.classList.add('tier-slot-missing');"
                />
                <div class="tier-missing">?</div>
              </div>
            ))}
          </div>
        </div>
      ))}
    </section>
  </div>

  <style>
    /* BACKGROUND */
    .tierpage-bg{
      position: fixed;
      inset: 0;
      z-index: -2;
      background-image: url("/images/tierlist-bg.png");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      filter: blur(1px) brightness(0.85) contrast(1.05) saturate(1.2);
      transform: scale(1.02);
    }

    .tierpage-bg-overlay{
      position: fixed;
      inset: 0;
      z-index: -1;
      background:
        radial-gradient(900px 650px at 20% 10%, rgba(106,168,255,.18), transparent 60%),
        radial-gradient(900px 650px at 80% 20%, rgba(159,91,255,.16), transparent 55%),
        linear-gradient(180deg, rgba(10,12,18,.30), rgba(10,12,18,.55));
    }

    /* PAGE */
    .tiers-page{
      max-width: 1100px;
      margin: 0 auto;
      padding: 26px 18px 80px;
      text-align: center;
    }

    .tiers-title{
      margin: 0;
      font-size: clamp(42px, 5vw, 66px);
      line-height: 1.02;
      letter-spacing: -0.02em;
    }

    .tiers-sub{
      margin: 14px auto 0;
      max-width: 82ch;
      color: var(--muted);
      line-height: 1.7;
      font-size: 16px;
    }

    .tiers-grid{
      margin-top: 26px;
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 22px;
    }

    /* CARD */
    .tier-card{
      border-radius: 22px;
      padding: 18px;
      border: 1px solid rgba(255,255,255,.20);
      background: rgba(0,0,0,.22);
      box-shadow: var(--shadow);
      transition: transform .14s ease, border-color .14s ease;
    }

    .tier-card:hover{
      transform: translateY(-2px);
      border-color: rgba(232,238,252,.6);
    }

    .tier-name{
      font-weight: 1000;
      letter-spacing: 0.08em;
      font-size: 22px;
      margin: 6px 0 18px;
    }

    /* SLOTS */
    .tier-slots{
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 14px;
    }

    .tier-slot{
      position: relative;
      aspect-ratio: 1 / 1;
      border-radius: 18px;
      border: 2px solid rgba(232,238,252,.75);
      background: rgba(0,0,0,.20);
      overflow: hidden;
    }

    /* Image is “flush”: it fills and crops at the border */
    .tier-slot img{
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: center;
      display: block;
    }

    /* "?" is present by default, hidden once image loads */
    .tier-missing{
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 44px;
      font-weight: 1000;
      color: rgba(232,238,252,.75);
      pointer-events: none;
    }

    /* If image exists and loads, hide the "?" */
    .tier-slot img:not([style*="display: none"]) + .tier-missing{
      opacity: 0;
    }

    /* If the image errors and gets hidden, show the "?" clearly */
    .tier-slot-missing .tier-missing{
      opacity: 1;
    }

    @media (max-width: 1000px){
      .tiers-grid{ grid-template-columns: repeat(2, 1fr); }
    }

    @media (max-width: 640px){
      .tiers-grid{ grid-template-columns: 1fr; }
    }
  </style>
</BaseLayout>
