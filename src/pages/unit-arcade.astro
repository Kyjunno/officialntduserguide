---
import BaseLayout from "../layouts/BaseLayout.astro";
const pageTitle = "Unit Arcade";
---

<BaseLayout title={pageTitle}>
  <main class="ua-root" id="uaRoot">
    <!-- SEARCH-ONLY VIEW -->
    <section id="searchView" class="ua-center" aria-label="Unit Arcade Search View">
      <div class="ua-card ua-cardBig">
        <h1 class="ua-title">Unit Arcade</h1>
        <p class="ua-sub">Type a unit name and press Enter, or click Open.</p>

        <div class="ua-row ua-rowBig">
          <div class="ua-field">
            <input
              id="unitSearch"
              class="ua-input ua-inputBig"
              type="text"
              placeholder="Search for a unit..."
              autocomplete="off"
              spellcheck="false"
            />
          </div>

          <button id="openBtn" class="ua-btn ua-btnBig" type="button">Open</button>
        </div>

        <p id="searchHint" class="ua-footnote">Example: Bear5, Bunny6, Big Band Bonnie</p>
      </div>
    </section>

    <!-- INFO VIEW -->
    <section id="infoView" class="ua-info" aria-label="Unit Arcade Info View">
      <div class="ua-infoWrap">
        <h1 id="unitTitle" class="ua-infoTitle">Unit Arcade</h1>
        <p id="unitSubtitle" class="ua-infoSub">Pick a unit to see details.</p>

        <div class="ua-panel">
          <div class="ua-panelRow">
            <div class="ua-panelLeft">
              <div class="ua-label">Search another unit</div>

              <div class="ua-row ua-rowTop">
                <div class="ua-field">
                  <input
                    id="unitSearchTop"
                    class="ua-input"
                    type="text"
                    placeholder="Search units..."
                    autocomplete="off"
                    spellcheck="false"
                  />
                </div>
                <button id="openBtnTop" class="ua-btn" type="button">Open</button>
              </div>

              <div class="ua-help">Press Enter or click Open.</div>
            </div>

            <div class="ua-imageBox">
              <img id="unitImg" class="ua-image" alt="" />
              <div id="unitImgLabel" class="ua-imageText">No image</div>
            </div>
          </div>

          <div class="ua-divider"></div>

          <div class="ua-stats4">
            <div class="ua-stat">
              <div class="ua-statK">RARITY</div>
              <div id="rarityVal" class="ua-statV">Not set</div>
            </div>
            <div class="ua-stat">
              <div class="ua-statK">ATTACK TYPE</div>
              <div id="attackVal" class="ua-statV">Not set</div>
            </div>
            <div class="ua-stat">
              <div class="ua-statK">PLACEMENT PRICE</div>
              <div id="priceVal" class="ua-statV">Not set</div>
            </div>
            <div class="ua-stat">
              <div class="ua-statK">PLACEMENTS</div>
              <div id="placementsVal" class="ua-statV">Not set</div>
            </div>
          </div>

          <div class="ua-divider"></div>

          <div class="ua-wide">
            <div class="ua-wideK">OBTAINABILITY</div>
            <div id="obtainVal" class="ua-wideV">Not set yet.</div>
          </div>

          <div class="ua-divider"></div>

          <div class="ua-wide">
            <div class="ua-wideK">ABILITY</div>
            <div id="abilityVal" class="ua-wideV">No abilities listed yet.</div>
          </div>
        </div>

        <!-- CALCULATOR -->
        <section class="ua-calc" aria-label="Unit Calculator">
          <h2 class="ua-calcTitle">Calculator</h2>
          <p class="ua-calcSub">Choose options and see computed stats.</p>

          <div class="ua-calcPanel">
            <div class="ua-calcControls">
              <label class="ua-control">
                <span class="ua-controlK">Level</span>
                <select id="levelSel" class="ua-select"></select>
              </label>

              <label class="ua-control">
                <span class="ua-controlK">Shiny</span>
                <select id="shinySel" class="ua-select">
                  <option value="0">Normal</option>
                  <option value="1">Shiny</option>
                </select>
              </label>

              <label class="ua-control">
                <span class="ua-controlK">Enchant</span>
                <select id="enchantSel" class="ua-select">
                  <option value="none">None</option>
                  <option value="damage3">Damage 3 (Max): +25% DMG</option>
                  <option value="range3">Range 3 (Max): +30% RNG</option>
                  <option value="cooldown3">Cooldown 3 (Max): -15% CD</option>

                  <option value="pizza_party">Pizza Party: +30% DMG, +20% RNG, -10% CD</option>
                  <option value="withered">Withered: +35% DMG, +35% RNG, +5% CD, +5% Bleed</option>
                  <option value="encased">Encased: +30% DMG, +20% RNG, +10% Slow, -10% CD</option>
                  <option value="fractured">Fractured: +65% DMG, +25% RNG, +20% Poison, +5% CD, +5% Slow</option>
                  <option value="clockworks">Clockworks: +35% DMG, +20% RNG, +20% Stun, +5% Burn, -25% CD</option>
                  <option value="diminished">Diminished: +135% DMG, +50% RNG, +35% CD, +15% Slow, +15% Bleed</option>
                  <option value="charlottes_offering">Charlotte&apos;s Offering: +65% DMG, +75% RNG, +20% Burn, +5% Slow, -10% CD</option>
                  <option value="help_wanted">Help Wanted: +75% DMG, +35% RNG, +15% Poison, +10% Stun, +5% Burn, -5% CD</option>
                  <option value="springlocked">Springlocked: +100% DMG, +35% RNG, +25% Stun, +15% Bleed, -10% CD</option>
                </select>
              </label>

              <label class="ua-control">
                <span class="ua-controlK">Chip</span>
                <select id="chipSel" class="ua-select" disabled>
                  <option value="none">Disabled (chip rules TBD)</option>
                </select>
              </label>

              <!-- Booster-only target selector -->
              <label class="ua-control" id="buffTargetWrap" style="display:none">
                <span class="ua-controlK">Buff Target</span>
                <select id="buffTargetSel" class="ua-select"></select>
              </label>
            </div>

            <div class="ua-calcGrid">
              <div class="ua-calcStat ua-out">
                <div class="ua-calcK">POWER</div>
                <div id="calcPower" class="ua-calcV">-</div>
              </div>

              <div class="ua-calcStat ua-out">
                <div id="calcDamageLabel" class="ua-calcK">DAMAGE</div>
                <div id="calcDamage" class="ua-calcV">-</div>
              </div>

              <div class="ua-calcStat ua-out">
                <div class="ua-calcK">COOLDOWN</div>
                <div id="calcCooldown" class="ua-calcV">-</div>
              </div>

              <div class="ua-calcStat ua-out">
                <div class="ua-calcK">RANGE</div>
                <div id="calcRange" class="ua-calcV">-</div>
              </div>
            </div>

            <div class="ua-calcNote" id="calcNote">Select a unit to compute stats.</div>
          </div>
        </section>
      </div>
    </section>
  </main>

  <script is:inline>
    const UNIT_NAMES = [
      "Bear5",
      "Test Dummy Endo",
      "Nightguard",
      "Chicken7",
      "Fan",
      "Bonnie",
      "Carl The Cupcake",
      "Freddy",
      "Foxy",
      "Chica",
      "Big Band Bonnie",
      "Golden Bonnie",
      "Bunny6",
      "Sparky The Dog",
      "Endo 01",
      "Bort Bunny",
      "Stuffed Freddy",
      "Phone Guy",
      "Golden Freddy",
      "Fox4",
      "The Amalgamation",
      "Shadow Freddy",
      "Endo Plush",
      "Crying Soul",
      "Lamp",

      // NEW UNITS
      "Fredrick Von Fazbear",
      "Bouncer",
      "Firework Foxy",
      "Freddy Frostbear",
      "Jolly Nightguard",
      "Ebeneezer Afton",
      "Red Nose Sparky",
      "Carl The Snowcake",
      "Terrance The Teacup",
      "Elf Bonnie",
      "Christmas Trica"
    ];

    // RULES LOCKED IN (per your clarifications):
    // - Dual means double hits on ONE target => hitMult multiplies on-hit damage.
    // - Range stays consistent regardless of attack type.
    // - Poison is a FLAT DPS once applied; does NOT scale with damage; only scales with +% poison sources.
    // - Bleed is DPS equal to (Damage * bleedPct) per second once applied; scales with damage AND +% bleed sources (bleedPct changes).
    // - Bleed/Poison bonuses are MULTIPLICATIVE (shiny/levels/enchants multiply the base bleed% or base poison DPS).
    // - Boosters: show BOOST % and POWER = added POWER per placement for a chosen target.
    // - Enchants do NOT affect booster boost% or booster output.
    // - Chips are disabled for now.

    const UNIT_DATA = {
      "Bear5": {
        id: "bear5",
        rarity: "Other",
        attackType: "AOE",
        placementPrice: "$555",
        placements: "1",
        obtainability: "Bear5 presents.",
        abilityName: "Mimic",
        abilityDesc: "Mimics the highest DPS on your team with a 1.25x stat modifier.",
        baseDamage: 555,
        baseCooldown: 0.5,
        baseRange: 20
      },

      "Shadow Freddy": {
        id: "shadow-freddy",
        rarity: "Vengeful",
        attackType: "AOE + Slow",
        placementPrice: "$12,500",
        placements: "1",
        obtainability: "Summons.",
        abilityName: "Detect Hidden",
        abilityDesc: "Has a 30% slow and detects hidden (does not reveal).",
        baseDamage: 100,
        baseCooldown: 0.1,
        baseRange: 20
      },

      "The Amalgamation": {
        id: "the-amalgamation",
        rarity: "Vengeful",
        attackType: "Cone AOE (50%)",
        placementPrice: "$15,000",
        placements: "1",
        obtainability: "Summons.",
        abilityName: "Team Buff",
        abilityDesc: "Every 60 seconds, boosts the DMG, RNG and CD of every unit in range by 10% each.",
        baseDamage: 1250,
        baseCooldown: 2,
        baseRange: 30
      },

      "Bunny6": {
        id: "bunny6",
        rarity: "Vengeful",
        attackType: "Single + Bleed",
        placementPrice: "$6,666",
        placements: "2",
        obtainability: "Bear5 Presents.",
        abilityName: "Bleed",
        abilityDesc: "50% bleed (non-stacking, permanent).",
        baseDamage: 1250,
        baseCooldown: 2.75,
        baseRange: 20,
        baseBleedPct: 0.50
      },

      "Big Band Bonnie": {
        id: "big-band-bonnie",
        rarity: "Vengeful",
        attackType: "Shockwave",
        placementPrice: "$2,500",
        placements: "2",
        obtainability: "Season 0 Pass.",
        abilityName: "Shockwave",
        abilityDesc: "Closer enemies take more damage, farther enemies take less damage. Stuns for 0.5 seconds.",
        baseDamage: 1000,
        baseCooldown: 2.5,
        baseRange: 22
      },

      "Fox4": {
        id: "fox4",
        rarity: "Legendary",
        attackType: "Single + Stun",
        placementPrice: "$2,500",
        placements: "4",
        obtainability: "Bear5 Presents.",
        abilityName: "Stun",
        abilityDesc: "0.3 second stun.",
        baseDamage: 300,
        baseCooldown: 2,
        baseRange: 18
      },

      "Sparky The Dog": {
        id: "sparky-the-dog",
        rarity: "Mythic",
        attackType: "Pierce + Bleed",
        placementPrice: "$2,750",
        placements: "2",
        obtainability: "Aftons Shop.",
        abilityName: "Bleed",
        abilityDesc: "20% bleed.",
        baseDamage: 400,
        baseCooldown: 2,
        baseRange: 25,
        baseBleedPct: 0.20
      },

      "Endo 01": {
        id: "endo-01",
        rarity: "Legendary",
        attackType: "Beam",
        placementPrice: "$2,500",
        placements: "4",
        obtainability: "Summons.",
        abilityName: "Income",
        abilityDesc: "+20% income on his attacks.",
        baseDamage: 15,
        baseCooldown: 0.15,
        baseRange: 22
      },

      "Golden Bonnie": {
        id: "golden-bonnie",
        rarity: "Mythic",
        attackType: "Pierce + Poison",
        placementPrice: "$4,500",
        placements: "2",
        obtainability: "Summons.",
        abilityName: "Poison",
        abilityDesc: "Poison deals 681 damage per second once applied (until death).",
        baseDamage: 300,
        baseCooldown: 2.5,
        baseRange: 25,
        basePoisonDps: 681
      },

      "Phone Guy": {
        id: "phone-guy",
        rarity: "Legendary",
        attackType: "Full AOE + Stun",
        placementPrice: "$3,000",
        placements: "2",
        obtainability: "Summons.",
        abilityName: "Stun",
        abilityDesc: "0.05 second stun. Applies a 2 second stun to every enemy in range (1s elites, 0.5s bosses).",
        baseDamage: 30,
        baseCooldown: 0.25,
        baseRange: 23
      },

      "Golden Freddy": {
        id: "golden-freddy",
        rarity: "Mythic",
        attackType: "Full AOE + Stun",
        placementPrice: "$5,000",
        placements: "2",
        obtainability: "Summons.",
        abilityName: "Stun",
        abilityDesc: "Has a 1 second stun.",
        baseDamage: 325,
        baseCooldown: 3,
        baseRange: 25
      },

      "Test Dummy Endo": {
        id: "test-dummy-endo",
        rarity: "Mythic",
        attackType: "Single",
        placementPrice: "$250",
        placements: "2",
        obtainability: "Beta exclusive unit.",
        abilityName: "Summons",
        abilityDesc: "Summons Double and Trouble who each deal 50% of TDE's damage.",
        baseDamage: 100,
        baseCooldown: 1,
        baseRange: 25,
        powerDamageMult: 2.0
      },

      "Nightguard": {
        id: "nightguard",
        rarity: "Legendary",
        attackType: "Cone AOE (50%)",
        placementPrice: "$750",
        placements: "3",
        obtainability: "Summons.",
        abilityName: "Debuffs",
        abilityDesc: "Has 0.15% burn (bugged rn), 15% slow and reveals hidden enemies.",
        baseDamage: 7.5,
        baseCooldown: 0.1,
        baseRange: 22
      },

      "Bort Bunny": {
        id: "bort-bunny",
        rarity: "Mythic",
        attackType: "Pierce + Boost",
        placementPrice: "$2,500",
        placements: "2",
        obtainability: "Bear5 presents.",
        abilityName: "Boost",
        abilityDesc: "10% CD boost and 50 pierce speed.",
        baseDamage: 90,
        baseCooldown: 1,
        baseRange: 25
      },

      "Stuffed Freddy": {
        id: "stuffed-freddy",
        rarity: "Mythic",
        attackType: "Blast + Burn",
        placementPrice: "$1,993",
        placements: "2",
        obtainability: "Summons.",
        abilityName: "Blast/Burn",
        abilityDesc: "20 blast radius and 1% burn.",
        baseDamage: 200,
        baseCooldown: 2,
        baseRange: 21
      },

      "Fan": {
        id: "fan",
        rarity: "Epic",
        attackType: "Cone AOE (50%)",
        placementPrice: "$750",
        placements: "4",
        obtainability: "Summons.",
        abilityName: "Slow",
        abilityDesc: "20% slowing.",
        baseDamage: 10,
        baseCooldown: 0.25,
        baseRange: 24
      },

      "Chicken7": {
        id: "chicken7",
        rarity: "Epic",
        attackType: "Beam + Dual",
        placementPrice: "$777",
        placements: "3",
        obtainability: "Bear5 Presents.",
        abilityName: "Dual + Income",
        abilityDesc: "Dual attacks (every attack hits twice) and +15% income on her attacks.",
        baseDamage: 5,
        baseCooldown: 0.1,
        baseRange: 22,
        hitMult: 2
      },

      "Lamp": {
        id: "lamp",
        rarity: "Epic",
        attackType: "Cone AOE (50%)",
        placementPrice: "$1,000",
        placements: "4",
        obtainability: "Summons.",
        abilityName: "Burn + Reveal",
        abilityDesc: "0.5% burn and reveals hidden enemies.",
        baseDamage: 10,
        baseCooldown: 0.25,
        baseRange: 15
      },

      "Freddy": {
        id: "freddy",
        rarity: "Common",
        attackType: "Single",
        placementPrice: "$100",
        placements: "3",
        obtainability: "Summons & Start.",
        abilityName: "None",
        abilityDesc: "None :(",
        baseDamage: 30,
        baseCooldown: 1,
        baseRange: 20
      },

      "Carl The Cupcake": {
        id: "carl-the-cupcake",
        rarity: "Rare",
        attackType: "Splash (35%) + Burn",
        placementPrice: "$250",
        placements: "2",
        obtainability: "Summons.",
        abilityName: "Splash/Burn",
        abilityDesc: "Splash deals 35% of damage to nearby enemies and 0.45% burn.",
        baseDamage: 54,
        baseCooldown: 1.25,
        baseRange: 20
      },

      "Foxy": {
        id: "foxy",
        rarity: "Rare",
        attackType: "Single",
        placementPrice: "$225",
        placements: "2",
        obtainability: "Summons.",
        abilityName: "Bleed",
        abilityDesc: "25% bleed.",
        baseDamage: 30,
        baseCooldown: 0.8,
        baseRange: 20,
        baseBleedPct: 0.25
      },

      "Chica": {
        id: "chica",
        rarity: "Common",
        attackType: "Dual",
        placementPrice: "$200",
        placements: "3",
        obtainability: "Summons & Start.",
        abilityName: "Dual",
        abilityDesc: "Dual attacks (every attack hits twice).",
        baseDamage: 16,
        baseCooldown: 1.25,
        baseRange: 18,
        hitMult: 2
      },

      "Bonnie": {
        id: "bonnie",
        rarity: "Common",
        attackType: "Cone AOE (25%)",
        placementPrice: "$150",
        placements: "2",
        obtainability: "Summons & Start.",
        abilityName: "None",
        abilityDesc: "None :(",
        baseDamage: 8,
        baseCooldown: 0.5,
        baseRange: 12
      },

      "Crying Soul": {
        id: "crying-soul",
        rarity: "Mythic",
        attackType: "Booster",
        placementPrice: "$999",
        placements: "3",
        obtainability: "Endless 1.",
        abilityName: "Damage Boost",
        abilityDesc: "Boosts all units damage in range by 15% (18.75% as shiny).",
        baseDamage: 0,
        baseCooldown: 1,
        baseRange: 18,
        boosterType: "damage",
        baseBoostPct: 0.15
      },

      "Endo Plush": {
        id: "endo-plush",
        rarity: "Epic",
        attackType: "Booster",
        placementPrice: "$500",
        placements: "3",
        obtainability: "Season 0 Pass.",
        abilityName: "Range Boost",
        abilityDesc: "Boosts all units range in range by 15% (18.75% as shiny).",
        baseDamage: 0,
        baseCooldown: 1,
        baseRange: 15,
        boosterType: "range",
        baseBoostPct: 0.15
      },

      // =========================
      // NEW UNITS (your drop)
      // =========================

      "Fredrick Von Fazbear": {
        id: "fredrick-von-fazbear",
        rarity: "Mythic",
        attackType: "Single",
        placementPrice: "$4,500",
        placements: "2",
        obtainability: "AFK presents.",
        abilityName: "Distinguished Execution",
        abilityDesc: "Every 5th attack deals +15% damage.",
        baseDamage: 780,
        baseCooldown: 2,
        baseRange: 28
      },

      "Bouncer": {
        id: "bouncer",
        rarity: "Mythic",
        attackType: "Single + Slow",
        placementPrice: "$2,500",
        placements: "4",
        obtainability: "Bouncer present.",
        abilityName: "Ice Bullets",
        abilityDesc: "Every 50 seconds, doubles this unit's slow.",
        baseDamage: 10,
        baseCooldown: 0.05,
        baseRange: 22
      },

      "Firework Foxy": {
        id: "firework-foxy",
        rarity: "Vengeful",
        attackType: "Blast + Burn",
        placementPrice: "$8,500",
        placements: "2",
        obtainability: "Firework Foxy present.",
        abilityName: "Firework Array",
        abilityDesc: "On Upgrade 1, spawns 1 shared turret system that fires every 30s, hitting 5 random enemies. Upgrades with the unit. Shiny affects array DMG and burn (not CD).",
        baseDamage: 750,
        baseCooldown: 2,
        baseRange: 22
      },

      "Freddy Frostbear": {
        id: "freddy-frostbear",
        rarity: "Vengeful",
        attackType: "Splash (35%) + Slow",
        placementPrice: "$3,000",
        placements: "3",
        obtainability: "Christmas presents.",
        abilityName: "Frosty Blade",
        abilityDesc: "Every 60 seconds, applies 50% Slow and Cone AOE (50%) for 10 seconds.",
        baseDamage: 200,
        baseCooldown: 1,
        baseRange: 25
      },

      "Jolly Nightguard": {
        id: "jolly-nightguard",
        rarity: "Legendary",
        attackType: "Splash (40%) + Slow",
        placementPrice: "$8,500",
        placements: "3",
        obtainability: "Christmas presents.",
        abilityName: "Give Gifts",
        abilityDesc: "Every 45 seconds, boosts all units' stats by 5% for 5 seconds.",
        baseDamage: 115,
        baseCooldown: 0.5,
        baseRange: 21
      },

      "Ebeneezer Afton": {
        id: "ebeneezer-afton",
        rarity: "Mythic",
        attackType: "Cone AOE (40%) + Burn + Reveal",
        placementPrice: "$8,500",
        placements: "2",
        obtainability: "Christmas presents.",
        abilityName: "Bah, humbug!",
        abilityDesc: "Every 45 seconds, this unit's burn doubles for 5 seconds.",
        baseDamage: 275,
        baseCooldown: 1,
        baseRange: 21
      },

      "Red Nose Sparky": {
        id: "red-nose-sparky",
        rarity: "Rare",
        attackType: "Single + Stun",
        placementPrice: "$2,000",
        placements: "2",
        obtainability: "Christmas presents.",
        abilityName: "Santa's Light",
        abilityDesc: "Every 45 seconds, slows all enemies in range by 15% for 5 seconds.",
        baseDamage: 200,
        baseCooldown: 1,
        baseRange: 20
      },

      "Carl The Snowcake": {
        id: "carl-the-snowcake",
        rarity: "Mythic",
        attackType: "Single + Slow",
        placementPrice: "$250",
        placements: "3",
        obtainability: "Carl The Snowcake presents.",
        abilityName: "Snowball Mayhem",
        abilityDesc: "Every 30 seconds, stuns all enemies in range for 0.5 seconds.",
        baseDamage: 70,
        baseCooldown: 0.75,
        baseRange: 22
      },

      "Terrance The Teacup": {
        id: "terrance-the-teacup",
        rarity: "Rare",
        attackType: "Splash (30%) + Burn",
        placementPrice: "$1,250",
        placements: "3",
        obtainability: "AFK presents.",
        abilityName: "None",
        abilityDesc: "No ability.",
        baseDamage: 87,
        baseCooldown: 1,
        baseRange: 21
      },

      "Elf Bonnie": {
        id: "elf-bonnie",
        rarity: "Common",
        attackType: "Single + Slow",
        placementPrice: "$125",
        placements: "2",
        obtainability: "Christmas presents.",
        abilityName: "Let It Snow",
        abilityDesc: "Every 60 seconds, applies 15% slow for 5 seconds.",
        baseDamage: 140,
        baseCooldown: 2,
        baseRange: 20
      },

      "Christmas Trica": {
        id: "christmas-trica",
        rarity: "Epic",
        attackType: "Booster",
        placementPrice: "$1,500",
        placements: "3",
        obtainability: "Christmas presents.",
        abilityName: "O Christmas Tree",
        abilityDesc: "Boosts CD by -15%. Every 35 seconds, slows all enemies in range for 5 seconds (15% slow if shiny).",
        baseDamage: 0,
        baseCooldown: 1,
        baseRange: 17,
        boosterType: "cooldown",
        baseBoostPct: 0.15
      }
    };

    const htmlEl = document.documentElement;
    const bodyEl = document.body;
    const rootEl = document.getElementById("uaRoot");

    const searchView = document.getElementById("searchView");
    const infoView = document.getElementById("infoView");

    const unitSearch = document.getElementById("unitSearch");
    const openBtn = document.getElementById("openBtn");
    const searchHint = document.getElementById("searchHint");

    const unitSearchTop = document.getElementById("unitSearchTop");
    const openBtnTop = document.getElementById("openBtnTop");

    const unitTitle = document.getElementById("unitTitle");
    const unitSubtitle = document.getElementById("unitSubtitle");
    const unitImg = document.getElementById("unitImg");
    const unitImgLabel = document.getElementById("unitImgLabel");

    const rarityVal = document.getElementById("rarityVal");
    const attackVal = document.getElementById("attackVal");
    const priceVal = document.getElementById("priceVal");
    const placementsVal = document.getElementById("placementsVal");
    const obtainVal = document.getElementById("obtainVal");
    const abilityVal = document.getElementById("abilityVal");

    const levelSel = document.getElementById("levelSel");
    const shinySel = document.getElementById("shinySel");
    const enchantSel = document.getElementById("enchantSel");
    const chipSel = document.getElementById("chipSel");

    const buffTargetWrap = document.getElementById("buffTargetWrap");
    const buffTargetSel = document.getElementById("buffTargetSel");

    const calcPower = document.getElementById("calcPower");
    const calcDamageLabel = document.getElementById("calcDamageLabel");
    const calcDamage = document.getElementById("calcDamage");
    const calcCooldown = document.getElementById("calcCooldown");
    const calcRange = document.getElementById("calcRange");
    const calcNote = document.getElementById("calcNote");

    let currentUnitName = "";
    let currentUnit = null;

    (function initLevels() {
      const frag = document.createDocumentFragment();
      for (let i = 1; i <= 100; i++) {
        const opt = document.createElement("option");
        opt.value = String(i);
        opt.textContent = String(i);
        frag.appendChild(opt);
      }
      levelSel.appendChild(frag);
      levelSel.value = "1";
    })();

    (function initBuffTargets() {
      const frag = document.createDocumentFragment();
      for (const name of UNIT_NAMES) {
        const u = UNIT_DATA[name];
        if (!u) continue;
        if (u.attackType === "Booster") continue;
        if (!Number.isFinite(u.baseDamage) || !Number.isFinite(u.baseCooldown) || !Number.isFinite(u.baseRange)) continue;

        const opt = document.createElement("option");
        opt.value = name;
        opt.textContent = name;
        frag.appendChild(opt);
      }
      buffTargetSel.appendChild(frag);

      const hasFreddy = [...buffTargetSel.options].some(o => o.value === "Freddy");
      if (hasFreddy) buffTargetSel.value = "Freddy";
      else if (buffTargetSel.options.length) buffTargetSel.value = buffTargetSel.options[0].value;
    })();

    function lockScroll() {
      htmlEl.classList.add("ua-lock");
      bodyEl.classList.add("ua-lock");
      rootEl.classList.add("ua-lock");
    }
    function unlockScroll() {
      htmlEl.classList.remove("ua-lock");
      bodyEl.classList.remove("ua-lock");
      rootEl.classList.remove("ua-lock");
    }

    infoView.style.display = "none";
    searchView.style.display = "grid";
    lockScroll();

    function normalizeName(s) {
      return (s || "").trim().toLowerCase();
    }

    function resolveUnitName(input) {
      const raw = (input || "").trim();
      if (!raw) return "";
      if (UNIT_NAMES.includes(raw)) return raw;

      const n = normalizeName(raw);
      const hit = UNIT_NAMES.find((u) => normalizeName(u) === n);
      return hit || "";
    }

    function trySetImage(unitId) {
      unitImgLabel.textContent = "No image";
      unitImg.style.display = "none";
      unitImg.removeAttribute("src");
      unitImg.alt = "";

      if (!unitId) return;

      const candidates = [
        `/images/units/${unitId}.png`,
        `/images/units/${unitId}.webp`,
        `/images/units/${unitId}.jpg`
      ];

      let idx = 0;
      unitImg.alt = currentUnitName ? `${currentUnitName} unit image` : "Unit image";
      unitImg.style.display = "block";
      unitImg.src = candidates[idx];

      unitImg.onerror = () => {
        idx += 1;
        if (idx < candidates.length) unitImg.src = candidates[idx];
        else {
          unitImg.onerror = null;
          unitImg.style.display = "none";
          unitImgLabel.textContent = "No image";
        }
      };

      unitImg.onload = () => {
        unitImgLabel.textContent = "";
      };
    }

    function fmt(n, digits = 2) {
      if (!Number.isFinite(n)) return "-";
      return n.toFixed(digits);
    }

    function parsePlacements(v) {
      const n = Number(String(v || "").replace(/[^\d.]/g, ""));
      return Number.isFinite(n) && n > 0 ? n : 1;
    }

    function applyShiny(isShiny, dmgMultObj, cdMultObj, rngMultObj, statusMultObj) {
      if (!isShiny) return;

      dmgMultObj.value *= 1.30;
      rngMultObj.value *= 1.20;
      cdMultObj.value *= 0.90;

      statusMultObj.boost *= 1.25;
      statusMultObj.bleed *= 1.20;
      statusMultObj.poison *= 1.20;

      statusMultObj.slow *= 1.10;
      statusMultObj.stun *= 1.10;
      statusMultObj.burn *= 1.10;
      statusMultObj.mimic *= 1.10;
    }

    function applyEnchant(key, dmgMultObj, cdMultObj, rngMultObj, statusMultObj) {
      const k = key || "none";
      if (k === "none") return;

      if (k === "damage3") dmgMultObj.value *= 1.25;
      if (k === "range3") rngMultObj.value *= 1.30;
      if (k === "cooldown3") cdMultObj.value *= 0.85;

      if (k === "pizza_party") { dmgMultObj.value *= 1.30; rngMultObj.value *= 1.20; cdMultObj.value *= 0.90; }
      if (k === "withered") { dmgMultObj.value *= 1.35; rngMultObj.value *= 1.35; cdMultObj.value *= 1.05; statusMultObj.bleed *= 1.05; }
      if (k === "encased") { dmgMultObj.value *= 1.30; rngMultObj.value *= 1.20; cdMultObj.value *= 0.90; statusMultObj.slow *= 1.10; }
      if (k === "fractured") { dmgMultObj.value *= 1.65; rngMultObj.value *= 1.25; cdMultObj.value *= 1.05; statusMultObj.poison *= 1.20; statusMultObj.slow *= 1.05; }
      if (k === "clockworks") { dmgMultObj.value *= 1.35; rngMultObj.value *= 1.20; cdMultObj.value *= 0.75; statusMultObj.stun *= 1.20; statusMultObj.burn *= 1.05; }
      if (k === "diminished") { dmgMultObj.value *= 2.35; rngMultObj.value *= 1.50; cdMultObj.value *= 1.35; statusMultObj.slow *= 1.15; statusMultObj.bleed *= 1.15; }
      if (k === "charlottes_offering") { dmgMultObj.value *= 1.65; rngMultObj.value *= 1.75; cdMultObj.value *= 0.90; statusMultObj.burn *= 1.20; statusMultObj.slow *= 1.05; }
      if (k === "help_wanted") { dmgMultObj.value *= 1.75; rngMultObj.value *= 1.35; cdMultObj.value *= 0.95; statusMultObj.poison *= 1.15; statusMultObj.stun *= 1.10; statusMultObj.burn *= 1.05; }
      if (k === "springlocked") { dmgMultObj.value *= 2.00; rngMultObj.value *= 1.35; cdMultObj.value *= 0.90; statusMultObj.stun *= 1.25; statusMultObj.bleed *= 1.15; }
    }

    // Per-placement POWER at base stats only (includes innate mechanics).
    function basePowerPerPlacement(unit) {
      if (!unit || unit.attackType === "Booster") return 0;
      if (!Number.isFinite(unit.baseDamage) || !Number.isFinite(unit.baseCooldown) || !Number.isFinite(unit.baseRange)) return 0;
      if (unit.baseCooldown <= 0) return 0;

      const hitMult = Number.isFinite(unit.hitMult) ? unit.hitMult : 1.0;
      const powerDamageMult = Number.isFinite(unit.powerDamageMult) ? unit.powerDamageMult : 1.0;

      const baseHitDps = (unit.baseDamage * hitMult) / unit.baseCooldown;

      const baseBleedPct = Number.isFinite(unit.baseBleedPct) ? unit.baseBleedPct : 0;
      const baseBleedDps = baseBleedPct > 0 ? (unit.baseDamage * baseBleedPct) : 0;

      const basePoisonDps = Number.isFinite(unit.basePoisonDps) ? unit.basePoisonDps : 0;

      const totalDps = (baseHitDps + baseBleedDps + basePoisonDps) * powerDamageMult;
      return (totalDps * unit.baseRange / 100);
    }

    // Recompute per-placement POWER if a booster modifies damage/range/cooldown.
    function boostedPowerPerPlacement(target, boosterType, boostPct) {
      if (!target || target.attackType === "Booster") return 0;
      if (!Number.isFinite(target.baseDamage) || !Number.isFinite(target.baseCooldown) || !Number.isFinite(target.baseRange)) return 0;
      if (target.baseCooldown <= 0) return 0;

      let dmg = target.baseDamage;
      let cd = target.baseCooldown;
      let rng = target.baseRange;

      if (boosterType === "damage") dmg = dmg * (1 + boostPct);
      if (boosterType === "range") rng = rng * (1 + boostPct);
      if (boosterType === "cooldown") cd = Math.max(0.01, cd * (1 - boostPct));

      const hitMult = Number.isFinite(target.hitMult) ? target.hitMult : 1.0;
      const powerDamageMult = Number.isFinite(target.powerDamageMult) ? target.powerDamageMult : 1.0;

      const hitDps = (dmg * hitMult) / cd;

      const baseBleedPct = Number.isFinite(target.baseBleedPct) ? target.baseBleedPct : 0;
      const bleedDps = baseBleedPct > 0 ? (dmg * baseBleedPct) : 0;

      const basePoisonDps = Number.isFinite(target.basePoisonDps) ? target.basePoisonDps : 0;
      const poisonDps = basePoisonDps;

      const totalDps = (hitDps + bleedDps + poisonDps) * powerDamageMult;
      return (totalDps * rng / 100);
    }

    function computeAndRender() {
      if (!currentUnit || !Number.isFinite(currentUnit.baseCooldown)) {
        calcPower.textContent = "-";
        calcDamageLabel.textContent = "DAMAGE";
        calcDamage.textContent = "-";
        calcCooldown.textContent = "-";
        calcRange.textContent = "-";
        calcNote.textContent = "This unit has no calculator stats set yet.";
        return;
      }

      const level = Number(levelSel.value || "1");
      const isShiny = Number(shinySel.value || "0") === 1;
      const lvl = Math.max(0, level - 1);
      const placements = parsePlacements(currentUnit.placements);

      const isBooster = !!(currentUnit.boosterType && Number.isFinite(currentUnit.baseBoostPct));

      // BOOSTER MODE: enchants/chips do not affect boost% or output at all
      if (isBooster) {
        let boostPct = currentUnit.baseBoostPct + (lvl * 0.00075); // 0.075% per level-up
        if (isShiny) boostPct *= 1.25;

        const targetName = buffTargetSel.value;
        const target = UNIT_DATA[targetName];

        if (!target || target.attackType === "Booster") {
          calcPower.textContent = "-";
          calcDamageLabel.textContent = "BOOST %";
          calcDamage.textContent = fmt(boostPct * 100, 3) + "%";
          calcCooldown.textContent = "-";
          calcRange.textContent = "-";
          calcNote.textContent = "Pick a valid buff target.";
          return;
        }

        const baseP = basePowerPerPlacement(target);
        const boostedP = boostedPowerPerPlacement(target, currentUnit.boosterType, boostPct);
        const addedPerPlacement = boostedP - baseP;

        calcDamageLabel.textContent = "BOOST %";
        calcDamage.textContent = fmt(boostPct * 100, 3) + "%";

        calcPower.textContent = fmt(addedPerPlacement, 3);
        calcCooldown.textContent = "-";
        calcRange.textContent = "-";
        calcNote.textContent = `POWER shows added POWER per placement for ${targetName}. (Enchants ignored for boosters)`;
        return;
      }

      // NORMAL MODE (attackers)
      if (!Number.isFinite(currentUnit.baseDamage)) {
        calcPower.textContent = "-";
        calcDamageLabel.textContent = "DAMAGE";
        calcDamage.textContent = "-";
        calcCooldown.textContent = "-";
        calcRange.textContent = "-";
        calcNote.textContent = "This unit has no calculator stats set yet.";
        return;
      }

      const dmgMult = { value: 1 };
      const cdMult = { value: 1 };
      const rngMult = { value: 1 };

      const statusMult = {
        boost: 1,
        bleed: 1,
        poison: 1,
        slow: 1,
        stun: 1,
        burn: 1,
        mimic: 1
      };

      // Level scaling: each level gives 2% of Shiny bonuses
      dmgMult.value *= 1 + lvl * 0.006;
      rngMult.value *= 1 + lvl * 0.004;
      cdMult.value *= 1 - lvl * 0.002;

      // Status scaling (multiplicative): multiply base status by (1 + lvl * perLevel)
      statusMult.boost *= 1 + lvl * 0.005;
      statusMult.bleed *= 1 + lvl * 0.004;
      statusMult.poison *= 1 + lvl * 0.004;
      statusMult.slow *= 1 + lvl * 0.002;
      statusMult.stun *= 1 + lvl * 0.002;
      statusMult.burn *= 1 + lvl * 0.002;
      statusMult.mimic *= 1 + lvl * 0.002;

      applyShiny(isShiny, dmgMult, cdMult, rngMult, statusMult);
      applyEnchant(enchantSel.value, dmgMult, cdMult, rngMult, statusMult);

      // Chips disabled: do nothing.

      const damage = currentUnit.baseDamage * dmgMult.value;
      const cooldown = Math.max(0.01, currentUnit.baseCooldown * cdMult.value);
      const range = (Number.isFinite(currentUnit.baseRange) ? currentUnit.baseRange : 0) * rngMult.value;

      const hitMult = Number.isFinite(currentUnit.hitMult) ? currentUnit.hitMult : 1.0;
      const powerDamageMult = Number.isFinite(currentUnit.powerDamageMult) ? currentUnit.powerDamageMult : 1.0;

      // Hit DPS
      const hitDps = (damage * hitMult) / cooldown;

      // Bleed DPS: damage * (finalBleedPct) per second
      const baseBleedPct = Number.isFinite(currentUnit.baseBleedPct) ? currentUnit.baseBleedPct : 0;
      const finalBleedPct = baseBleedPct > 0 ? (baseBleedPct * statusMult.bleed) : 0;
      const bleedDps = finalBleedPct > 0 ? (damage * finalBleedPct) : 0;

      // Poison DPS: flat per second, independent of damage/cooldown; scales only with poison multipliers
      const basePoisonDps = Number.isFinite(currentUnit.basePoisonDps) ? currentUnit.basePoisonDps : 0;
      const poisonDps = basePoisonDps > 0 ? (basePoisonDps * statusMult.poison) : 0;

      const totalDps = (hitDps + bleedDps + poisonDps) * powerDamageMult;
      const power = (totalDps * range / 100) * placements;

      calcDamageLabel.textContent = "DAMAGE";
      calcPower.textContent = fmt(power, 2);
      calcDamage.textContent = fmt(damage, 2);
      calcCooldown.textContent = fmt(cooldown, 3);
      calcRange.textContent = Number.isFinite(range) ? fmt(range, 1) : "-";

      calcNote.textContent =
        "POWER = ((Hit DPS + Bleed DPS + Poison DPS) × RNG / 100) × placements. Chips disabled.";
    }

    function loadUnitFromInput(value) {
      const unitName = resolveUnitName(value);
      if (!unitName) {
        searchHint.textContent = `No exact match found. Try one of: ${UNIT_NAMES.slice(0, 5).join(", ")}...`;
        return;
      }

      currentUnitName = unitName;
      currentUnit = UNIT_DATA[unitName] || null;

      const isBooster = !!(currentUnit && currentUnit.boosterType && Number.isFinite(currentUnit.baseBoostPct));
      buffTargetWrap.style.display = isBooster ? "" : "none";

      searchView.style.display = "none";
      infoView.style.display = "block";
      unlockScroll();

      unitTitle.textContent = unitName;
      unitSubtitle.textContent = "Unit details and calculator.";

      unitSearchTop.value = unitName;

      const data = UNIT_DATA[unitName] || {};
      rarityVal.textContent = data.rarity || "Not set";
      attackVal.textContent = data.attackType || "Not set";
      priceVal.textContent = data.placementPrice || "Not set";
      placementsVal.textContent = data.placements || "Not set";
      obtainVal.textContent = data.obtainability || "Not set yet.";

      const aName = (data.abilityName || "").trim();
      const aDesc = (data.abilityDesc || "").trim();
      if (aName && aDesc) abilityVal.textContent = `${aName}: ${aDesc}`;
      else if (aName) abilityVal.textContent = aName;
      else if (aDesc) abilityVal.textContent = aDesc;
      else abilityVal.textContent = "No abilities listed yet.";

      trySetImage(data.id || "");
      computeAndRender();

      window.scrollTo({ top: 0, behavior: "instant" });
    }

    openBtn.addEventListener("click", () => loadUnitFromInput(unitSearch.value));
    openBtnTop.addEventListener("click", () => loadUnitFromInput(unitSearchTop.value));

    unitSearch.addEventListener("keydown", (e) => {
      if (e.key === "Enter") loadUnitFromInput(unitSearch.value);
    });
    unitSearchTop.addEventListener("keydown", (e) => {
      if (e.key === "Enter") loadUnitFromInput(unitSearchTop.value);
    });

    levelSel.addEventListener("change", computeAndRender);
    shinySel.addEventListener("change", computeAndRender);
    enchantSel.addEventListener("change", computeAndRender);
    buffTargetSel.addEventListener("change", computeAndRender);
  </script>

  <style>
    :global(body) { background: transparent !important; }

    :global(body::before) {
      content: "";
      position: fixed;
      inset: 0;
      z-index: -2;
      background-image: url("/images/unit-arcade-bg.png");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      filter: blur(8px) saturate(0.95);
      transform: scale(1.05);
    }

    :global(body::after) {
      content: "";
      position: fixed;
      inset: 0;
      z-index: -1;
      background: rgba(5, 10, 20, 0.30);
      pointer-events: none;
    }

    :global(html.ua-lock),
    :global(body.ua-lock) {
      height: 100% !important;
      overflow: hidden !important;
    }
    .ua-lock {
      height: 100% !important;
      overflow: hidden !important;
    }

    .ua-root {
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px;
    }

    .ua-center {
      min-height: calc(100vh - 140px);
      display: grid;
      place-items: center;
    }

    .ua-card {
      width: min(760px, 100%);
      border-radius: 18px;
      border: 1px solid rgba(180, 210, 255, 0.18);
      background: rgba(10, 15, 25, 0.55);
      backdrop-filter: blur(10px);
      padding: 22px;
      text-align: center;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.35);
      overflow: visible;
    }

    .ua-cardBig {
      width: min(980px, 100%);
      padding: 34px;
    }

    .ua-title { margin: 0 0 6px; font-size: 2.3rem; font-weight: 900; }
    .ua-sub { margin: 0 0 16px; opacity: 0.85; font-size: 1.05rem; }

    .ua-row {
      display: grid;
      grid-template-columns: 1fr 110px;
      gap: 10px;
      align-items: start;
    }

    .ua-rowBig {
      grid-template-columns: 1fr 140px;
      gap: 12px;
    }

    .ua-rowTop {
      grid-template-columns: 1fr 110px;
      margin-top: 6px;
    }

    .ua-field { position: relative; width: 100%; overflow: visible; }

    .ua-input {
      width: 100%;
      border-radius: 14px;
      border: 1px solid rgba(180, 210, 255, 0.18);
      background: rgba(5, 8, 15, 0.55);
      padding: 14px 14px;
      outline: none;
      color: inherit;
      font-size: 1rem;
    }

    .ua-inputBig {
      padding: 18px 16px;
      font-size: 1.1rem;
    }

    .ua-btn {
      border-radius: 14px;
      border: 1px solid rgba(180, 210, 255, 0.20);
      background: rgba(25, 40, 70, 0.35);
      padding: 14px;
      cursor: pointer;
      font-weight: 900;
      height: 52px;
    }

    .ua-btnBig {
      height: 60px;
      font-size: 1.05rem;
    }

    .ua-footnote {
      margin: 14px 0 0;
      font-size: 0.9rem;
      opacity: 0.75;
    }

    .ua-infoWrap { padding-bottom: 72px; }
    .ua-infoTitle { margin: 0 0 6px; font-size: 2.2rem; font-weight: 900; }
    .ua-infoSub { margin: 0 0 18px; opacity: 0.85; }

    .ua-panel {
      border-radius: 18px;
      border: 1px solid rgba(180, 210, 255, 0.18);
      background: rgba(10, 15, 25, 0.55);
      backdrop-filter: blur(10px);
      padding: 20px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.35);
      overflow: visible;
    }

    .ua-panelRow {
      display: grid;
      grid-template-columns: 1fr 260px;
      gap: 16px;
      align-items: stretch;
    }

    .ua-label {
      font-size: 0.85rem;
      font-weight: 800;
      letter-spacing: 0.04em;
      opacity: 0.9;
      margin-bottom: 10px;
      text-align: left;
    }

    .ua-help {
      margin-top: 10px;
      font-size: 0.8rem;
      opacity: 0.65;
      text-align: left;
    }

    .ua-imageBox {
      border-radius: 16px;
      border: 1px solid rgba(180, 210, 255, 0.18);
      background: rgba(5, 8, 15, 0.35);
      display: grid;
      place-items: center;
      overflow: hidden;
      position: relative;
      min-height: 240px;
    }

    .ua-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: none;
    }

    .ua-imageText {
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      opacity: 0.7;
      font-weight: 800;
      pointer-events: none;
    }

    .ua-divider {
      height: 1px;
      background: rgba(180, 210, 255, 0.14);
      margin: 18px 0;
    }

    .ua-stats4 {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
    }

    .ua-stat {
      border-radius: 14px;
      border: 1px solid rgba(180, 210, 255, 0.14);
      background: rgba(5, 8, 15, 0.35);
      padding: 12px;
      text-align: center;
    }

    .ua-statK {
      font-size: 0.72rem;
      font-weight: 900;
      letter-spacing: 0.06em;
      opacity: 0.75;
    }

    .ua-statV { margin-top: 8px; font-weight: 800; }

    .ua-wide {
      border-radius: 14px;
      border: 1px solid rgba(180, 210, 255, 0.14);
      background: rgba(5, 8, 15, 0.35);
      padding: 14px;
    }

    .ua-wideK {
      font-size: 0.72rem;
      font-weight: 900;
      letter-spacing: 0.06em;
      opacity: 0.75;
      margin-bottom: 10px;
    }

    .ua-wideV { font-weight: 700; opacity: 0.9; }

    .ua-calc { margin-top: 20px; }

    .ua-calcTitle {
      margin: 18px 0 6px;
      font-size: 1.6rem;
      font-weight: 900;
    }

    .ua-calcSub { margin: 0 0 12px; opacity: 0.85; }

    .ua-calcPanel {
      border-radius: 18px;
      border: 1px solid rgba(180, 210, 255, 0.18);
      background: rgba(10, 15, 25, 0.55);
      backdrop-filter: blur(10px);
      padding: 18px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.35);
    }

    .ua-calcControls {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
    }

    .ua-control { display: grid; gap: 8px; }

    .ua-controlK {
      font-size: 0.72rem;
      font-weight: 900;
      letter-spacing: 0.06em;
      opacity: 0.8;
    }

    .ua-select {
      width: 100%;
      border-radius: 14px;
      border: 1px solid rgba(180, 210, 255, 0.18);
      background: rgba(5, 8, 15, 0.55);
      padding: 12px 12px;
      outline: none;
      color: inherit;
      font-weight: 800;
    }

    .ua-calcGrid {
      margin-top: 14px;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
    }

    .ua-calcStat {
      border-radius: 14px;
      border: 1px solid rgba(180, 210, 255, 0.14);
      background: rgba(5, 8, 15, 0.35);
      padding: 12px;
    }

    .ua-out { text-align: center; }

    .ua-calcK {
      font-size: 0.72rem;
      font-weight: 900;
      letter-spacing: 0.06em;
      opacity: 0.75;
    }

    .ua-calcV {
      margin-top: 8px;
      font-weight: 900;
      font-size: 1.2rem;
    }

    .ua-calcNote {
      margin-top: 12px;
      opacity: 0.7;
      font-weight: 700;
      text-align: center;
    }

    @media (max-width: 900px) {
      .ua-row { grid-template-columns: 1fr; }
      .ua-rowBig { grid-template-columns: 1fr; }
      .ua-panelRow { grid-template-columns: 1fr; }
      .ua-stats4 { grid-template-columns: repeat(2, 1fr); }
      .ua-calcControls { grid-template-columns: repeat(2, 1fr); }
      .ua-calcGrid { grid-template-columns: repeat(2, 1fr); }
    }
  </style>
</BaseLayout>
