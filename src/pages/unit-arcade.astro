---
import BaseLayout from "../layouts/BaseLayout.astro";
const pageTitle = "Unit Arcade";
---

<BaseLayout title={pageTitle}>
  <main class="ua-root" id="uaRoot">
    <!-- SEARCH-ONLY VIEW -->
    <section id="searchView" class="ua-center" aria-label="Unit Arcade Search View">
      <div class="ua-card ua-cardBig">
        <h1 class="ua-title">Unit Arcade</h1>
        <p class="ua-sub">Type a unit name and press Enter, or click Open.</p>

        <div class="ua-row ua-rowBig">
          <div class="ua-field">
            <input
              id="unitSearch"
              class="ua-input ua-inputBig"
              type="text"
              placeholder="Search for a unit..."
              autocomplete="off"
              spellcheck="false"
            />
          </div>

          <button id="openBtn" class="ua-btn ua-btnBig" type="button">Open</button>
        </div>

        <p id="searchHint" class="ua-footnote">Example: Bear5, Bunny6, Shadow Freddy</p>
      </div>
    </section>

    <!-- INFO VIEW -->
    <section id="infoView" class="ua-info" aria-label="Unit Arcade Info View">
      <div class="ua-infoWrap">
        <h1 id="unitTitle" class="ua-infoTitle">Unit Arcade</h1>
        <p id="unitSubtitle" class="ua-infoSub">Pick a unit to see details.</p>

        <div class="ua-panel">
          <div class="ua-panelRow">
            <div class="ua-panelLeft">
              <div class="ua-label">Search another unit</div>

              <div class="ua-row ua-rowTop">
                <div class="ua-field">
                  <input
                    id="unitSearchTop"
                    class="ua-input"
                    type="text"
                    placeholder="Search units..."
                    autocomplete="off"
                    spellcheck="false"
                  />
                </div>
                <button id="openBtnTop" class="ua-btn" type="button">Open</button>
              </div>

              <div class="ua-help">Press Enter or click Open.</div>
            </div>

            <div class="ua-imageBox">
              <img id="unitImg" class="ua-image" alt="" />
              <div id="unitImgLabel" class="ua-imageText">No image</div>
            </div>
          </div>

          <div class="ua-divider"></div>

          <div class="ua-stats4">
            <div class="ua-stat">
              <div class="ua-statK">RARITY</div>
              <div id="rarityVal" class="ua-statV">Not set</div>
            </div>
            <div class="ua-stat">
              <div class="ua-statK">ATTACK TYPE</div>
              <div id="attackVal" class="ua-statV">Not set</div>
            </div>
            <div class="ua-stat">
              <div class="ua-statK">PLACEMENT PRICE</div>
              <div id="priceVal" class="ua-statV">Not set</div>
            </div>
            <div class="ua-stat">
              <div class="ua-statK">PLACEMENTS</div>
              <div id="placementsVal" class="ua-statV">Not set</div>
            </div>
          </div>

          <div class="ua-divider"></div>

          <div class="ua-wide">
            <div class="ua-wideK">OBTAINABILITY</div>
            <div id="obtainVal" class="ua-wideV">Not set yet.</div>
          </div>

          <div class="ua-divider"></div>

          <div class="ua-wide">
            <div class="ua-wideK">ABILITY</div>
            <div id="abilityVal" class="ua-wideV">No abilities listed yet.</div>
          </div>
        </div>

        <!-- CALCULATOR -->
        <section class="ua-calc" aria-label="Unit Calculator">
          <h2 class="ua-calcTitle">Calculator</h2>
          <p class="ua-calcSub">Choose options and see computed stats.</p>

          <div class="ua-calcPanel">
            <div class="ua-calcControls">
              <label class="ua-control">
                <span class="ua-controlK">Level</span>
                <select id="levelSel" class="ua-select"></select>
              </label>

              <label class="ua-control">
                <span class="ua-controlK">Shiny</span>
                <select id="shinySel" class="ua-select">
                  <option value="0">Normal</option>
                  <option value="1">Shiny</option>
                </select>
              </label>

              <label class="ua-control">
                <span class="ua-controlK">Enchant</span>
                <select id="enchantSel" class="ua-select">
                  <option value="none">None</option>
                  <option value="damage3">Damage 3 (Max): +25% DMG</option>
                  <option value="range3">Range 3 (Max): +30% RNG</option>
                  <option value="cooldown3">Cooldown 3 (Max): -15% CD</option>

                  <option value="pizza_party">Pizza Party: +30% DMG, +20% RNG, -10% CD</option>
                  <option value="withered">Withered: +35% DMG, +35% RNG, +5% CD, +5% Bleed</option>
                  <option value="encased">Encased: +30% DMG, +20% RNG, -10% CD, +10% Slow</option>
                  <option value="fractured">Fractured: +65% DMG, +25% RNG, +5% CD, +20% Poison, +5% Slow</option>
                  <option value="clockworks">Clockworks: +35% DMG, +20% RNG, -25% CD, +20% Stun, +5% Burn</option>
                  <option value="diminished">Diminished: +135% DMG, +50% RNG, +35% CD, +15% Slow, +15% Bleed</option>
                  <option value="charlottes_offering">Charlotte&apos;s Offering: +65% DMG, +75% RNG, -10% CD, +20% Burn, +5% Slow</option>
                  <option value="help_wanted">Help Wanted: +75% DMG, +35% RNG, -5% CD, +15% Poison, +10% Stun, +5% Burn</option>
                  <option value="springlocked">Springlocked: +100% DMG, +35% RNG, -10% CD, +25% Stun, +15% Bleed</option>
                </select>
              </label>

              <label class="ua-control">
                <span class="ua-controlK">Chip</span>
                <select id="chipSel" class="ua-select">
                  <option value="none">None</option>
                  <option value="dmg15">DMG +15%</option>
                  <option value="dmg30">DMG +30%</option>
                  <option value="cd15">CD -15%</option>
                  <option value="rng15">RNG +15%</option>
                </select>
              </label>
            </div>

            <div class="ua-calcGrid">
              <div class="ua-calcStat ua-out">
                <div class="ua-calcK">POWER</div>
                <div id="calcPower" class="ua-calcV">-</div>
              </div>
              <div class="ua-calcStat ua-out">
                <div class="ua-calcK">DAMAGE</div>
                <div id="calcDamage" class="ua-calcV">-</div>
              </div>
              <div class="ua-calcStat ua-out">
                <div class="ua-calcK">COOLDOWN</div>
                <div id="calcCooldown" class="ua-calcV">-</div>
              </div>
              <div class="ua-calcStat ua-out">
                <div class="ua-calcK">RANGE</div>
                <div id="calcRange" class="ua-calcV">-</div>
              </div>
            </div>

            <div class="ua-calcNote" id="calcNote">Select a unit to compute stats.</div>
          </div>
        </section>
      </div>
    </section>
  </main>

  <script is:inline>
    const UNIT_NAMES = [
      "Bear5",
      "Test Dummy Endo",
      "Nightguard",
      "Chicken7",
      "Fan",
      "Bonnie",
      "Carl The Cupcake",
      "Freddy",
      "Foxy",
      "Chica",
      "Big Band Bonnie",
      "Golden Bonnie",
      "Bunny6",
      "Sparky The Dog",
      "Endo 01",
      "Bort Bunny",
      "Stuffed Freddy",
      "Phone Guy",
      "Golden Freddy",
      "Fox4",
      "The Amalgamation",
      "Shadow Freddy",
      "Endo Plush",
      "Crying Soul",
      "Lamp"
    ];

    const UNIT_DATA = {
      "Bear5": {
        id: "bear5",
        rarity: "Other",
        attackType: "AOE",
        placementPrice: "$555",
        placements: "1",
        obtainability: "Bear5 presents.",
        abilityName: "Mimic",
        abilityDesc: "Mimics the highest DPS on your team with a 1.25x stat modifier.",
        baseDamage: 555,
        baseCooldown: 0.5,
        baseRange: 20
      },

      "Shadow Freddy": {
        id: "shadow-freddy",
        rarity: "Vengeful",
        attackType: "AOE + Slow",
        placementPrice: "$12,500",
        placements: "1",
        obtainability: "Summons",
        abilityName: "Detect Hidden",
        abilityDesc: "Has a 30% slow and detects hidden (does not reveal).",
        baseDamage: 100,
        baseCooldown: 0.1,
        baseRange: 20
      },

      "The Amalgamation": {
        id: "the-amalgamation",
        rarity: "Vengeful",
        attackType: "Cone AOE (50%)",
        placementPrice: "$15,000",
        placements: "1",
        obtainability: "Not set yet.",
        abilityName: "Team Buff",
        abilityDesc: "Every 60 seconds, boosts the DMG, RNG and CD of every unit in range by 10% each.",
        baseDamage: 1250,
        baseCooldown: 2,
        baseRange: 30
      },

      "Bunny6": {
        id: "bunny6",
        rarity: "Vengeful",
        attackType: "Single + Bleed",
        placementPrice: "$6,666",
        placements: "2",
        obtainability: "Not set yet.",
        abilityName: "Bleed",
        abilityDesc: "50% bleed. Bleed deals 50% of Bunny6's damage every second to the target. The bleed never leaves, but it does not stack.",
        baseDamage: 1250,
        baseCooldown: 2.75,
        baseRange: 20
      },

      "Golden Bonnie": {
        id: "golden-bonnie",
        rarity: "Mythic",
        attackType: "Pierce + Poison",
        placementPrice: "$4,500",
        placements: "2",
        obtainability: "Not set yet.",
        abilityName: "Not set",
        abilityDesc: "Not set",
        baseDamage: 50.5,
        baseCooldown: 2.0,
        baseRange: 27.5
      }
    };

    const htmlEl = document.documentElement;
    const bodyEl = document.body;
    const rootEl = document.getElementById("uaRoot");

    const searchView = document.getElementById("searchView");
    const infoView = document.getElementById("infoView");

    const unitSearch = document.getElementById("unitSearch");
    const openBtn = document.getElementById("openBtn");
    const searchHint = document.getElementById("searchHint");

    const unitSearchTop = document.getElementById("unitSearchTop");
    const openBtnTop = document.getElementById("openBtnTop");

    const unitTitle = document.getElementById("unitTitle");
    const unitSubtitle = document.getElementById("unitSubtitle");
    const unitImg = document.getElementById("unitImg");
    const unitImgLabel = document.getElementById("unitImgLabel");

    const rarityVal = document.getElementById("rarityVal");
    const attackVal = document.getElementById("attackVal");
    const priceVal = document.getElementById("priceVal");
    const placementsVal = document.getElementById("placementsVal");
    const obtainVal = document.getElementById("obtainVal");
    const abilityVal = document.getElementById("abilityVal");

    const levelSel = document.getElementById("levelSel");
    const shinySel = document.getElementById("shinySel");
    const enchantSel = document.getElementById("enchantSel");
    const chipSel = document.getElementById("chipSel");

    const calcPower = document.getElementById("calcPower");
    const calcDamage = document.getElementById("calcDamage");
    const calcCooldown = document.getElementById("calcCooldown");
    const calcRange = document.getElementById("calcRange");
    const calcNote = document.getElementById("calcNote");

    let currentUnitName = "";
    let currentUnit = null;

    (function initLevels() {
      const frag = document.createDocumentFragment();
      for (let i = 1; i <= 100; i++) {
        const opt = document.createElement("option");
        opt.value = String(i);
        opt.textContent = String(i);
        frag.appendChild(opt);
      }
      levelSel.appendChild(frag);
      levelSel.value = "1";
    })();

    function lockScroll() {
      htmlEl.classList.add("ua-lock");
      bodyEl.classList.add("ua-lock");
      rootEl.classList.add("ua-lock");
    }
    function unlockScroll() {
      htmlEl.classList.remove("ua-lock");
      bodyEl.classList.remove("ua-lock");
      rootEl.classList.remove("ua-lock");
    }

    infoView.style.display = "none";
    searchView.style.display = "grid";
    lockScroll();

    function normalizeName(s) {
      return (s || "").trim().toLowerCase();
    }

    function resolveUnitName(input) {
      const raw = (input || "").trim();
      if (!raw) return "";
      if (UNIT_NAMES.includes(raw)) return raw;

      const n = normalizeName(raw);
      const hit = UNIT_NAMES.find(u => normalizeName(u) === n);
      return hit || "";
    }

    function trySetImage(unitId) {
      unitImgLabel.textContent = "No image";
      unitImg.style.display = "none";
      unitImg.removeAttribute("src");
      unitImg.alt = "";

      if (!unitId) return;

      const candidates = [
        `/images/units/${unitId}.png`,
        `/images/units/${unitId}.webp`,
        `/images/units/${unitId}.jpg`
      ];

      let idx = 0;
      unitImg.alt = currentUnitName ? `${currentUnitName} unit image` : "Unit image";
      unitImg.style.display = "block";
      unitImg.src = candidates[idx];

      unitImg.onerror = () => {
        idx += 1;
        if (idx < candidates.length) unitImg.src = candidates[idx];
        else {
          unitImg.onerror = null;
          unitImg.style.display = "none";
          unitImgLabel.textContent = "No image";
        }
      };

      unitImg.onload = () => {
        unitImgLabel.textContent = "";
      };
    }

    function fmt(n, digits = 2) {
      if (!Number.isFinite(n)) return "-";
      return n.toFixed(digits);
    }

    function parsePlacements(v) {
      const n = Number(String(v || "").replace(/[^\d.]/g, ""));
      return Number.isFinite(n) && n > 0 ? n : 1;
    }

    function applyShiny(isShiny, dmgMultObj, cdMultObj, rngMultObj, statusBonusObj) {
      if (!isShiny) return;

      dmgMultObj.value *= 1.30;
      rngMultObj.value *= 1.20;
      cdMultObj.value *= 0.90;

      statusBonusObj.boost += 0.25;
      statusBonusObj.bleed += 0.20;
      statusBonusObj.poison += 0.20;
      statusBonusObj.slow += 0.10;
      statusBonusObj.stun += 0.10;
      statusBonusObj.burn += 0.10;
      statusBonusObj.mimic += 0.10;
    }

    function applyEnchant(key, dmgMultObj, cdMultObj, rngMultObj, statusBonusObj) {
      const k = key || "none";
      if (k === "none") return;

      if (k === "damage3") dmgMultObj.value *= 1.25;
      if (k === "range3") rngMultObj.value *= 1.30;
      if (k === "cooldown3") cdMultObj.value *= 0.85;

      if (k === "pizza_party") { dmgMultObj.value *= 1.30; rngMultObj.value *= 1.20; cdMultObj.value *= 0.90; }
      if (k === "withered") { dmgMultObj.value *= 1.35; rngMultObj.value *= 1.35; cdMultObj.value *= 1.05; statusBonusObj.bleed += 0.05; }
      if (k === "encased") { dmgMultObj.value *= 1.30; rngMultObj.value *= 1.20; cdMultObj.value *= 0.90; statusBonusObj.slow += 0.10; }
      if (k === "fractured") { dmgMultObj.value *= 1.65; rngMultObj.value *= 1.25; cdMultObj.value *= 1.05; statusBonusObj.poison += 0.20; statusBonusObj.slow += 0.05; }
      if (k === "clockworks") { dmgMultObj.value *= 1.35; rngMultObj.value *= 1.20; cdMultObj.value *= 0.75; statusBonusObj.stun += 0.20; statusBonusObj.burn += 0.05; }
      if (k === "diminished") { dmgMultObj.value *= 2.35; rngMultObj.value *= 1.50; cdMultObj.value *= 1.35; statusBonusObj.slow += 0.15; statusBonusObj.bleed += 0.15; }
      if (k === "charlottes_offering") { dmgMultObj.value *= 1.65; rngMultObj.value *= 1.75; cdMultObj.value *= 0.90; statusBonusObj.burn += 0.20; statusBonusObj.slow += 0.05; }
      if (k === "help_wanted") { dmgMultObj.value *= 1.75; rngMultObj.value *= 1.35; cdMultObj.value *= 0.95; statusBonusObj.poison += 0.15; statusBonusObj.stun += 0.10; statusBonusObj.burn += 0.05; }
      if (k === "springlocked") { dmgMultObj.value *= 2.00; rngMultObj.value *= 1.35; cdMultObj.value *= 0.90; statusBonusObj.stun += 0.25; statusBonusObj.bleed += 0.15; }
    }

    function applyChip(key, dmgMultObj, cdMultObj, rngMultObj, statusBonusObj) {
      const k = key || "none";
      if (k === "dmg15") dmgMultObj.value *= 1.15;
      if (k === "dmg30") dmgMultObj.value *= 1.30;
      if (k === "cd15") cdMultObj.value *= 0.85;
      if (k === "rng15") rngMultObj.value *= 1.15;
    }

    function computeAndRender() {
      if (!currentUnit || !Number.isFinite(currentUnit.baseDamage) || !Number.isFinite(currentUnit.baseCooldown)) {
        calcPower.textContent = "-";
        calcDamage.textContent = "-";
        calcCooldown.textContent = "-";
        calcRange.textContent = "-";
        calcNote.textContent = "This unit has no calculator stats set yet.";
        return;
      }

      const level = Number(levelSel.value || "1");
      const isShiny = Number(shinySel.value || "0") === 1;

      const dmgMult = { value: 1 };
      const cdMult  = { value: 1 };
      const rngMult = { value: 1 };

      const statusBonus = {
        boost: 0,
        bleed: 0,
        poison: 0,
        slow: 0,
        stun: 0,
        burn: 0,
        mimic: 0
      };

      const lvl = Math.max(0, level - 1);

      dmgMult.value *= 1 + lvl * 0.006;
      rngMult.value *= 1 + lvl * 0.004;
      cdMult.value  *= 1 - lvl * 0.002;

      statusBonus.boost  += lvl * 0.005;
      statusBonus.bleed  += lvl * 0.004;
      statusBonus.poison += lvl * 0.004;
      statusBonus.slow   += lvl * 0.002;
      statusBonus.stun   += lvl * 0.002;
      statusBonus.burn   += lvl * 0.002;
      statusBonus.mimic  += lvl * 0.002;

      applyShiny(isShiny, dmgMult, cdMult, rngMult, statusBonus);
      applyEnchant(enchantSel.value, dmgMult, cdMult, rngMult, statusBonus);
      applyChip(chipSel.value, dmgMult, cdMult, rngMult, statusBonus);

      const damage = currentUnit.baseDamage * dmgMult.value;
      const cooldown = Math.max(0.05, currentUnit.baseCooldown * cdMult.value);
      const range = (Number.isFinite(currentUnit.baseRange) ? currentUnit.baseRange : 0) * rngMult.value;

      const dps = damage / cooldown;
      const placements = parsePlacements(currentUnit.placements);

      const power = (dps * range / 100) * placements;

      calcPower.textContent = fmt(power, 2);
      calcDamage.textContent = fmt(damage, 2);
      calcCooldown.textContent = fmt(cooldown, 3);
      calcRange.textContent = Number.isFinite(range) ? fmt(range, 1) : "-";

      calcNote.textContent =
        "Levels add 2% of Shiny bonuses per level. POWER = (DPS × RNG / 100) × placements.";
    }

    function loadUnitFromInput(value) {
      const unitName = resolveUnitName(value);
      if (!unitName) {
        searchHint.textContent = `No exact match found. Try one of: ${UNIT_NAMES.slice(0, 5).join(", ")}...`;
        return;
      }

      currentUnitName = unitName;
      currentUnit = UNIT_DATA[unitName] || null;

      searchView.style.display = "none";
      infoView.style.display = "block";
      unlockScroll();

      unitTitle.textContent = unitName;
      unitSubtitle.textContent = "Unit details and calculator.";

      unitSearchTop.value = unitName;

      const data = UNIT_DATA[unitName] || {};
      rarityVal.textContent = data.rarity || "Not set";
      attackVal.textContent = data.attackType || "Not set";
      priceVal.textContent = data.placementPrice || "Not set";
      placementsVal.textContent = data.placements || "Not set";
      obtainVal.textContent = data.obtainability || "Not set yet.";

      const aName = (data.abilityName || "").trim();
      const aDesc = (data.abilityDesc || "").trim();
      if (aName && aDesc) abilityVal.textContent = `${aName}: ${aDesc}`;
      else if (aName) abilityVal.textContent = aName;
      else if (aDesc) abilityVal.textContent = aDesc;
      else abilityVal.textContent = "No abilities listed yet.";

      trySetImage(data.id || "");
      computeAndRender();

      window.scrollTo({ top: 0, behavior: "instant" });
    }

    openBtn.addEventListener("click", () => loadUnitFromInput(unitSearch.value));
    openBtnTop.addEventListener("click", () => loadUnitFromInput(unitSearchTop.value));

    unitSearch.addEventListener("keydown", (e) => {
      if (e.key === "Enter") loadUnitFromInput(unitSearch.value);
    });
    unitSearchTop.addEventListener("keydown", (e) => {
      if (e.key === "Enter") loadUnitFromInput(unitSearchTop.value);
    });

    levelSel.addEventListener("change", computeAndRender);
    shinySel.addEventListener("change", computeAndRender);
    enchantSel.addEventListener("change", computeAndRender);
    chipSel.addEventListener("change", computeAndRender);
  </script>

  <style>
    :global(body) { background: transparent !important; }

    :global(body::before) {
      content: "";
      position: fixed;
      inset: 0;
      z-index: -2;
      background-image: url("/images/unit-arcade-bg.png");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      filter: blur(8px) saturate(0.95);
      transform: scale(1.05);
    }

    :global(body::after) {
      content: "";
      position: fixed;
      inset: 0;
      z-index: -1;
      background: rgba(5, 10, 20, 0.30);
      pointer-events: none;
    }

    :global(html.ua-lock),
    :global(body.ua-lock) {
      height: 100% !important;
      overflow: hidden !important;
    }
    .ua-lock {
      height: 100% !important;
      overflow: hidden !important;
    }

    .ua-root {
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px;
    }

    .ua-center {
      min-height: calc(100vh - 140px);
      display: grid;
      place-items: center;
    }

    .ua-card {
      width: min(760px, 100%);
      border-radius: 18px;
      border: 1px solid rgba(180, 210, 255, 0.18);
      background: rgba(10, 15, 25, 0.55);
      backdrop-filter: blur(10px);
      padding: 22px;
      text-align: center;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.35);
      overflow: visible;
    }

    .ua-cardBig {
      width: min(980px, 100%);
      padding: 34px;
    }

    .ua-title { margin: 0 0 6px; font-size: 2.3rem; font-weight: 900; }
    .ua-sub { margin: 0 0 16px; opacity: 0.85; font-size: 1.05rem; }

    .ua-row {
      display: grid;
      grid-template-columns: 1fr 110px;
      gap: 10px;
      align-items: start;
    }

    .ua-rowBig {
      grid-template-columns: 1fr 140px;
      gap: 12px;
    }

    .ua-rowTop {
      grid-template-columns: 1fr 110px;
      margin-top: 6px;
    }

    .ua-field { position: relative; width: 100%; overflow: visible; }

    .ua-input {
      width: 100%;
      border-radius: 14px;
      border: 1px solid rgba(180, 210, 255, 0.18);
      background: rgba(5, 8, 15, 0.55);
      padding: 14px 14px;
      outline: none;
      color: inherit;
      font-size: 1rem;
    }

    .ua-inputBig {
      padding: 18px 16px;
      font-size: 1.1rem;
    }

    .ua-btn {
      border-radius: 14px;
      border: 1px solid rgba(180, 210, 255, 0.20);
      background: rgba(25, 40, 70, 0.35);
      padding: 14px;
      cursor: pointer;
      font-weight: 900;
      height: 52px;
    }

    .ua-btnBig {
      height: 60px;
      font-size: 1.05rem;
    }

    .ua-footnote {
      margin: 14px 0 0;
      font-size: 0.9rem;
      opacity: 0.75;
    }

    .ua-infoWrap { padding-bottom: 72px; }
    .ua-infoTitle { margin: 0 0 6px; font-size: 2.2rem; font-weight: 900; }
    .ua-infoSub { margin: 0 0 18px; opacity: 0.85; }

    .ua-panel {
      border-radius: 18px;
      border: 1px solid rgba(180, 210, 255, 0.18);
      background: rgba(10, 15, 25, 0.55);
      backdrop-filter: blur(10px);
      padding: 20px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.35);
      overflow: visible;
    }

    .ua-panelRow {
      display: grid;
      grid-template-columns: 1fr 260px;
      gap: 16px;
      align-items: stretch;
    }

    .ua-label {
      font-size: 0.85rem;
      font-weight: 800;
      letter-spacing: 0.04em;
      opacity: 0.9;
      margin-bottom: 10px;
      text-align: left;
    }

    .ua-help {
      margin-top: 10px;
      font-size: 0.8rem;
      opacity: 0.65;
      text-align: left;
    }

    .ua-imageBox {
      border-radius: 16px;
      border: 1px solid rgba(180, 210, 255, 0.18);
      background: rgba(5, 8, 15, 0.35);
      display: grid;
      place-items: center;
      overflow: hidden;
      position: relative;
      min-height: 240px;
    }

    .ua-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: none;
    }

    .ua-imageText {
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      opacity: 0.7;
      font-weight: 800;
      pointer-events: none;
    }

    .ua-divider {
      height: 1px;
      background: rgba(180, 210, 255, 0.14);
      margin: 18px 0;
    }

    .ua-stats4 {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
    }

    .ua-stat {
      border-radius: 14px;
      border: 1px solid rgba(180, 210, 255, 0.14);
      background: rgba(5, 8, 15, 0.35);
      padding: 12px;
      text-align: center;
    }

    .ua-statK {
      font-size: 0.72rem;
      font-weight: 900;
      letter-spacing: 0.06em;
      opacity: 0.75;
    }

    .ua-statV { margin-top: 8px; font-weight: 800; }

    .ua-wide {
      border-radius: 14px;
      border: 1px solid rgba(180, 210, 255, 0.14);
      background: rgba(5, 8, 15, 0.35);
      padding: 14px;
    }

    .ua-wideK {
      font-size: 0.72rem;
      font-weight: 900;
      letter-spacing: 0.06em;
      opacity: 0.75;
      margin-bottom: 10px;
    }

    .ua-wideV { font-weight: 700; opacity: 0.9; }

    .ua-calc { margin-top: 20px; }

    .ua-calcTitle {
      margin: 18px 0 6px;
      font-size: 1.6rem;
      font-weight: 900;
    }

    .ua-calcSub { margin: 0 0 12px; opacity: 0.85; }

    .ua-calcPanel {
      border-radius: 18px;
      border: 1px solid rgba(180, 210, 255, 0.18);
      background: rgba(10, 15, 25, 0.55);
      backdrop-filter: blur(10px);
      padding: 18px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.35);
    }

    .ua-calcControls {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
    }

    .ua-control { display: grid; gap: 8px; }

    .ua-controlK {
      font-size: 0.72rem;
      font-weight: 900;
      letter-spacing: 0.06em;
      opacity: 0.8;
    }

    .ua-select {
      width: 100%;
      border-radius: 14px;
      border: 1px solid rgba(180, 210, 255, 0.18);
      background: rgba(5, 8, 15, 0.55);
      padding: 12px 12px;
      outline: none;
      color: inherit;
      font-weight: 800;
    }

    .ua-calcGrid {
      margin-top: 14px;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
    }

    .ua-calcStat {
      border-radius: 14px;
      border: 1px solid rgba(180, 210, 255, 0.14);
      background: rgba(5, 8, 15, 0.35);
      padding: 12px;
    }

    .ua-out { text-align: center; }

    .ua-calcK {
      font-size: 0.72rem;
      font-weight: 900;
      letter-spacing: 0.06em;
      opacity: 0.75;
    }

    .ua-calcV {
      margin-top: 8px;
      font-weight: 900;
      font-size: 1.2rem;
    }

    .ua-calcNote {
      margin-top: 12px;
      opacity: 0.7;
      font-weight: 700;
      text-align: center;
    }

    @media (max-width: 900px) {
      .ua-row { grid-template-columns: 1fr; }
      .ua-rowBig { grid-template-columns: 1fr; }
      .ua-panelRow { grid-template-columns: 1fr; }
      .ua-stats4 { grid-template-columns: repeat(2, 1fr); }
      .ua-calcControls { grid-template-columns: repeat(2, 1fr); }
      .ua-calcGrid { grid-template-columns: repeat(2, 1fr); }
    }
  </style>
</BaseLayout>
