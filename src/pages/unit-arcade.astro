---
// src/pages/unit-arcade.astro
import Layout from "../layouts/Layout.astro";

const units = [
  "Bear5",
  "Test Dummy Endo",
  "Nightguard",
  "Chicken7",
  "Fan",
  "Bonnie",
  "Carl The Cupcake",
  "Freddy",
  "Foxy",
  "Chica",
  "Big Band Bonnie",
  "Golden Bonnie",
  "Bunny6",
  "Sparky The Dog",
  "Endo 01",
  "Bort Bunny",
  "Stuffed Freddy",
  "Phone Guy",
  "Golden Freddy",
  "Fox4",
  "The Amalgamation",
  "Shadow Freddy",
  "Endo Plush",
  "Crying Soul",
  "Lamp",
];
---
<Layout title="Unit Arcade | Official NTD User Guide">
  <section class="ua">
    <div class="bg"></div>

    <div class="centerCard" id="pickCard" aria-hidden="false">
      <h1>Unit Arcade</h1>
      <p class="sub">Type a unit name and pick from the dropdown.</p>

      <div class="searchWrap" id="searchWrap">
        <input id="unitInput" type="text" placeholder="Search units..." autocomplete="off" />
        <div class="dropdown" id="dropdown" role="listbox" aria-label="Unit list" hidden>
          <div class="dropdownInner" id="dropdownInner"></div>
        </div>
      </div>
    </div>

    <div class="details" id="details" hidden>
      <div class="detailsShell">
        <div class="topRow">
          <div class="left">
            <div class="searchLine">
              <div class="label">Unit search</div>
              <div class="searchInline">
                <input id="unitInput2" type="text" placeholder="Search units..." autocomplete="off" />
                <div class="dropdown inline" id="dropdown2" role="listbox" aria-label="Unit list" hidden>
                  <div class="dropdownInner" id="dropdownInner2"></div>
                </div>
              </div>
              <div class="hint">Click the search bar to browse, or type to filter.</div>
            </div>

            <div class="metaGrid">
              <div class="metaBox">
                <div class="k">Rarity</div>
                <div class="v" id="rarityVal">Not set</div>
              </div>
              <div class="metaBox">
                <div class="k">Attack Type</div>
                <div class="v" id="attackVal">Not set</div>
              </div>
              <div class="metaBox">
                <div class="k">Placement Price</div>
                <div class="v" id="priceVal">Not set</div>
              </div>
              <div class="metaBox">
                <div class="k">Placements</div>
                <div class="v" id="placeVal">Not set</div>
              </div>
            </div>

            <div class="wideBox">
              <div class="k">Obtainability</div>
              <div class="v muted">Not set yet.</div>
            </div>

            <div class="wideBox">
              <div class="row2">
                <div class="k">Ability</div>
                <div class="k right">Description</div>
              </div>
              <div class="row2">
                <div class="v muted">No abilities listed yet.</div>
                <div class="v muted right">Add this later.</div>
              </div>
            </div>
          </div>

          <div class="right">
            <div class="portrait" id="portrait">
              <div class="noImg">No image</div>
            </div>
          </div>
        </div>

        <div class="calc">
          <div class="calcTitle">Calculator</div>
          <div class="calcRow">
            <div class="field">
              <div class="k">Level</div>
              <input type="number" min="1" max="100" value="1" />
            </div>

            <div class="field">
              <div class="k">Variant</div>
              <select>
                <option>Normal</option>
                <option>Shiny</option>
              </select>
            </div>

            <div class="field">
              <div class="k">Enchant</div>
              <select>
                <option>None</option>
                <option>DMG</option>
                <option>CD</option>
                <option>RNG</option>
              </select>
            </div>

            <div class="field">
              <div class="k">Chip</div>
              <select>
                <option>None</option>
                <option>Critical Strikes</option>
                <option>Attack Speed</option>
                <option>Range</option>
              </select>
            </div>

            <button class="applyBtn" type="button">Apply</button>
          </div>

          <div class="calcGrid">
            <div class="statBox">
              <div class="k">Cost</div>
              <div class="v">0</div>
            </div>
            <div class="statBox">
              <div class="k">DPS</div>
              <div class="v">0</div>
            </div>
            <div class="statBox">
              <div class="k">Damage</div>
              <div class="v">0</div>
            </div>
            <div class="statBox">
              <div class="k">Cooldown</div>
              <div class="v">0</div>
            </div>
            <div class="statBox">
              <div class="k">Range</div>
              <div class="v">0</div>
            </div>
          </div>

          <div class="note muted">
            This calculator is a shell for now. Once your unit data table is added, weâ€™ll compute real numbers.
          </div>
        </div>
      </div>
    </div>
  </section>

  <script is:inline>
    const UNITS = ${JSON.stringify(units)};

    const pickCard = document.getElementById("pickCard");
    const details = document.getElementById("details");

    const input1 = document.getElementById("unitInput");
    const dd1 = document.getElementById("dropdown");
    const ddInner1 = document.getElementById("dropdownInner");

    const input2 = document.getElementById("unitInput2");
    const dd2 = document.getElementById("dropdown2");
    const ddInner2 = document.getElementById("dropdownInner2");

    const portrait = document.getElementById("portrait");

    function norm(s){ return (s || "").toLowerCase().trim(); }

    function setNoScroll(on){
      document.body.classList.toggle("no-scroll", !!on);
    }

    function buildList(targetInner, targetDd, query){
      const q = norm(query);
      const filtered = q ? UNITS.filter(u => norm(u).includes(q)) : UNITS.slice();
      const top = filtered.slice(0, 50);

      targetInner.innerHTML = "";
      for (const name of top){
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "ddItem";
        btn.textContent = name;
        btn.addEventListener("click", () => selectUnit(name));
        targetInner.appendChild(btn);
      }

      targetDd.hidden = top.length === 0;
    }

    function openDropdown(which){
      if (which === 1){
        buildList(ddInner1, dd1, input1.value);
        dd1.hidden = false;
      } else {
        buildList(ddInner2, dd2, input2.value);
        dd2.hidden = false;
      }
    }

    function closeDropdowns(){
      dd1.hidden = true;
      dd2.hidden = true;
    }

    function selectUnit(name){
      closeDropdowns();

      input1.value = name;
      input2.value = name;

      pickCard.hidden = true;
      pickCard.setAttribute("aria-hidden", "true");

      details.hidden = false;

      setNoScroll(false);

      // Placeholder image wiring: looks for /units/<slug>.png in public
      // Example: public/units/bear5.png
      const slug = name.toLowerCase().replace(/[^a-z0-9]+/g, "-").replace(/(^-|-$)/g, "");
      const imgPath = `/units/${slug}.png`;

      portrait.innerHTML = "";
      const img = document.createElement("img");
      img.src = imgPath;
      img.alt = name;
      img.loading = "lazy";
      img.addEventListener("error", () => {
        portrait.innerHTML = '<div class="noImg">No image</div>';
      });
      portrait.appendChild(img);
    }

    function initialState(){
      pickCard.hidden = false;
      pickCard.setAttribute("aria-hidden", "false");
      details.hidden = true;
      closeDropdowns();
      setNoScroll(true);
    }

    // initial
    initialState();

    // input 1 behavior (center card)
    input1.addEventListener("focus", () => openDropdown(1));
    input1.addEventListener("click", () => openDropdown(1));
    input1.addEventListener("input", () => openDropdown(1));

    // input 2 behavior (details view)
    input2.addEventListener("focus", () => openDropdown(2));
    input2.addEventListener("click", () => openDropdown(2));
    input2.addEventListener("input", () => openDropdown(2));

    // click outside closes dropdown
    document.addEventListener("mousedown", (e) => {
      const in1 = e.target.closest("#searchWrap");
      const in2 = e.target.closest(".searchInline");
      if (!in1 && !in2) closeDropdowns();
    });

    // escape closes dropdown
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") closeDropdowns();
    });
  </script>

  <style>
    .ua{
      position: relative;
      min-height: calc(100vh - 64px);
      padding: 26px 0 40px;
    }

    .bg{
      position: fixed;
      inset: 0;
      z-index: -2;
      background-image: url("/unit-arcade-bg.png");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      filter: blur(10px);
      transform: scale(1.05);
    }
    .bg::after{
      content:"";
      position:absolute;
      inset:0;
      background: radial-gradient(1000px 600px at 25% 10%, rgba(18,30,58,.55), rgba(0,0,0,.62));
    }

    .centerCard{
      width: min(860px, 94vw);
      margin: 80px auto 0;
      padding: 28px 28px 22px;
      border-radius: 18px;
      background: rgba(10,14,22,.58);
      border: 1px solid rgba(170,195,255,.18);
      box-shadow: 0 18px 60px rgba(0,0,0,.35);
      text-align: center;
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
    }

    .centerCard h1{
      margin:0;
      font-size: 40px;
      letter-spacing:.3px;
      font-weight: 850;
    }

    .sub{
      margin: 8px 0 18px;
      color: rgba(232,238,252,.75);
      font-size: 14px;
    }

    .searchWrap{
      position: relative;
      width: min(740px, 92%);
      margin: 0 auto;
    }

    input[type="text"], input[type="number"], select{
      width:100%;
      padding: 12px 14px;
      border-radius: 14px;
      border: 1px solid rgba(170,195,255,.18);
      background: rgba(7,10,16,.55);
      color: rgba(232,238,252,.92);
      outline:none;
    }
    input::placeholder{ color: rgba(232,238,252,.42); }

    .dropdown{
      position: absolute;
      left: 0;
      right: 0;
      top: calc(100% + 10px);
      background: rgba(7,10,16,.92);
      border: 1px solid rgba(170,195,255,.22);
      border-radius: 14px;
      box-shadow: 0 18px 60px rgba(0,0,0,.45);
      overflow: hidden;
      z-index: 40;
    }

    .dropdown.inline{
      top: calc(100% + 8px);
    }

    .dropdownInner{
      max-height: 360px; /* shows ~10 items, scroll inside */
      overflow: auto;
      padding: 8px;
    }

    .ddItem{
      width: 100%;
      display: block;
      text-align: center;
      padding: 12px 10px;
      margin: 6px 0;
      border-radius: 12px;
      border: 1px solid rgba(170,195,255,.12);
      background: rgba(20,28,45,.35);
      color: rgba(232,238,252,.92);
      font-weight: 800;
      letter-spacing: .2px;
      cursor: pointer;
      transition: .12s ease;
    }
    .ddItem:hover{
      background: rgba(125,160,255,.14);
      border-color: rgba(170,195,255,.22);
      transform: translateY(-1px);
    }

    .details{
      width: min(1100px, 96vw);
      margin: 28px auto 0;
    }

    .detailsShell{
      padding: 22px;
      border-radius: 18px;
      background: rgba(10,14,22,.62);
      border: 1px solid rgba(170,195,255,.18);
      box-shadow: 0 18px 60px rgba(0,0,0,.35);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
    }

    .topRow{
      display:grid;
      grid-template-columns: 1fr 220px;
      gap: 18px;
      align-items:start;
    }

    .label{
      font-size: 12px;
      color: rgba(232,238,252,.7);
      font-weight: 800;
      letter-spacing: .8px;
      text-transform: uppercase;
      margin-bottom: 8px;
    }

    .hint{
      margin-top: 8px;
      color: rgba(232,238,252,.55);
      font-size: 12px;
    }

    .searchInline{
      position: relative;
    }

    .metaGrid{
      margin-top: 14px;
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
    }

    .metaBox, .wideBox, .statBox{
      border-radius: 14px;
      border: 1px solid rgba(170,195,255,.14);
      background: rgba(7,10,16,.48);
      padding: 12px 12px;
    }

    .k{
      font-size: 12px;
      color: rgba(232,238,252,.7);
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: .8px;
      margin-bottom: 6px;
    }

    .v{
      font-size: 14px;
      font-weight: 750;
      color: rgba(232,238,252,.92);
    }

    .muted{ color: rgba(232,238,252,.58); }

    .wideBox{
      margin-top: 12px;
    }

    .row2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      align-items: center;
    }
    .right{ text-align:right; }

    .portrait{
      width: 220px;
      height: 220px; /* bigger portrait */
      border-radius: 18px;
      border: 1px solid rgba(170,195,255,.18);
      background: rgba(7,10,16,.55);
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
    }
    .portrait img{
      width:100%;
      height:100%;
      object-fit: cover;
      display:block;
    }
    .noImg{
      color: rgba(232,238,252,.55);
      font-weight: 750;
    }

    .calc{
      margin-top: 16px;
      padding: 16px;
      border-radius: 18px;
      border: 1px solid rgba(170,195,255,.18);
      background: rgba(7,10,16,.42);
    }

    .calcTitle{
      font-size: 22px;
      font-weight: 900;
      margin-bottom: 12px;
    }

    .calcRow{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr 1fr auto;
      gap: 10px;
      align-items:end;
    }

    .field .k{ margin-bottom: 6px; }

    .applyBtn{
      padding: 12px 16px;
      border-radius: 14px;
      border: 1px solid rgba(170,195,255,.20);
      background: rgba(20,28,45,.55);
      color: rgba(232,238,252,.92);
      font-weight: 850;
      cursor: pointer;
      transition: .12s ease;
      height: 44px;
    }
    .applyBtn:hover{
      background: rgba(125,160,255,.16);
    }

    .calcGrid{
      margin-top: 12px;
      display:grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 10px;
    }

    .note{
      margin-top: 10px;
      font-size: 12px;
      line-height: 1.35;
    }

    @media (max-width: 980px){
      .topRow{ grid-template-columns: 1fr; }
      .portrait{ width: 100%; height: 260px; }
      .metaGrid{ grid-template-columns: 1fr 1fr; }
      .calcRow{ grid-template-columns: 1fr 1fr; }
      .calcGrid{ grid-template-columns: 1fr 1fr; }
    }
  </style>
</Layout>
